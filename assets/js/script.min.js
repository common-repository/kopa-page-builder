"use strict";var $kpb_media_2nd,KPB,KPB_Assets,KPB_Col,KPB_Layout,KPB_Layout_Customize,KPB_Layouts,KPB_Lightbox,KPB_Main_Form,KPB_Overlay,KPB_Row,KPB_Tips,KPB_UI,KPB_UI_Attachment_Image,KPB_UI_Color,KPB_UI_Image,KPB_UI_Numeric_Slider,KPB_Util,KPB_Widget,KPB_Widgets,KPB_Wrapper,kpb_current_sidebar,kpb_current_widget,kpb_media,kpb_media_button_reset,kpb_media_button_upload;kpb_current_widget={},kpb_current_sidebar={},kpb_media=!1,kpb_media_button_upload={},kpb_media_button_reset={},$kpb_media_2nd=!1,jQuery(window).on("load",function(){KPB.prepare()}),KPB={_get_builder_id:function(){return"#kpb-metabox"},_get_btn_toggle_id:function(){return"#kpb-toggle-editor"},_get_btn_save_id:function(){return"#kpb-button-save-layouts"},get_elements:function(){return"#wp-content-editor-container, #post-status-info, #insert-media-button, .wp-editor-tabs"},prepare:function(){var e;e=jQuery("#kpb-select-layout option:selected").val(),"disable"!==e&&KPB_Layout.load(e)},toggle:function(e){var t,a;e.preventDefault(),a=jQuery(KPB._get_btn_toggle_id()),t=jQuery(KPB._get_builder_id()),t.is(":visible")?KPB.off(a):KPB.on(a)},on:function(e){jQuery(KPB.get_elements()).hide(),jQuery(KPB._get_builder_id()).show(),e.addClass("button-primary")},off:function(e){jQuery(KPB.get_elements()).show(),jQuery(KPB._get_builder_id()).hide(),e.removeClass("button-primary")},force_save:function(){jQuery(KPB._get_btn_save_id()).click()}},KPB_Main_Form={_get_form_id:function(){return"#post"},mark_it:function(e){var t;t=jQuery(KPB_Main_Form._get_form_id()),t.length&&(e?t.addClass("kpb-marked"):t.removeClass("kpb-marked"))},do_submit:function(){}},KPB_Wrapper={_get_id:function(){return"#kpb-wrapper"}},KPB_Overlay={_get_id:function(){return"#kpb-loading-overlay"},show:function(){jQuery(KPB_Overlay._get_id()).stop().animate({display:"block",bottom:"0px"},500)},hide:function(){jQuery(KPB_Overlay._get_id()).animate({display:"none",bottom:"-100px"},500)}},KPB_Assets={init:function(){KPB_UI.init(),KPB_Assets.init_tooltip(),KPB_Assets.init_tabs(),KPB_Assets.init_sortable()},init_tooltip:function(){jQuery(".kpb-tooltip").tooltip({tooltipClass:"kpb-ui-tooltip",position:{my:"center bottom",at:"center top-6"},show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300}})},force_close_tooltip:function(){jQuery(".kpb-tooltip").tooltip("close")},init_tabs:function(){var e;e=jQuery(".kpb-tab-title > a"),e.length>0&&e.each(function(){var e;e=jQuery(this),e.click(function(t){var a,i;t.preventDefault(),i=e.parents(".kpb-tabs"),a=e.parent(),a.hasClass("kpb-tab-title-active")||(i.find(".kpb-tab-title-active").removeClass("kpb-tab-title-active"),i.find(".kpb-tab-content").slideUp(500),a.addClass("kpb-tab-title-active"),jQuery(e.attr("href")).slideDown(500))})})},init_sortable:function(){jQuery(KPB_Widget._get_placeholder_class()).sortable({forcePlaceholderSize:!0,connectWith:KPB_Widget._get_placeholder_class(),placeholder:"kpb-widget-sortable-placeholder",start:function(e,t){return t.placeholder.height(t.helper.outerHeight()-2)}}).disableSelection()}},KPB_Widgets={_get_id:function(){return"#kpb-widgets-lightbox"},load:function(){jQuery.ajax({url:KPB_Config.ajax,dataType:"html",type:"POST",async:!0,data:{action:"kpb_load_widgets",security:jQuery("#kpb_load_widgets_security").val()},beforeSend:function(){KPB_Overlay.show()},success:function(e){e&&jQuery("body").append(e)},complete:function(){KPB_Assets.init(),KPB_Widgets.show(),KPB_Overlay.hide()}})},show:function(){var e;e=KPB_Widgets._get_id(),jQuery.magnificPopup.open({callbacks:{open:function(){jQuery(e).show()},close:function(){jQuery(e).hide()}},modal:!0,preloader:!0,alignTop:!0,items:{src:e,type:"inline"}})},open:function(e,t){var a;e.preventDefault(),kpb_current_sidebar=t.parents(".kpb-area"),a=KPB_Widgets._get_id(),jQuery(a).length?KPB_Widgets.show():KPB_Widgets.load()},close:function(e){e.preventDefault(),jQuery.magnificPopup.close()}},KPB_Widget={_get_id:function(){return"#kpb-widget-lightbox"},_get_placeholder_class:function(){return".kpb-area-placeholder"},get_placeholder:function(){jQuery(KPB_Widget._get_id()).length||jQuery.ajax({url:KPB_Config.ajax,dataType:"html",type:"POST",async:!0,data:{action:"kpb_load_widget_placeholder",security:jQuery("#kpb_load_widget_placeholder_security").val(),post_id:jQuery("#post_ID").val()},beforeSend:function(){KPB_Overlay.show()},success:function(e){jQuery("body").append(e)},complete:function(){KPB_Assets.init(),KPB_Overlay.hide()}})},prepare_form:function(e,t,a,i,n){jQuery("#kpb-widget input[name=kpb-widget-id]").val(e),jQuery("#kpb-widget input[name=kpb-widget-name]").val(t),jQuery("#kpb-widget-title").text(a),jQuery("#kpb-widget input[name=kpb-widget-class-name]").val(i),jQuery("#kpb-widget input[name=kpb-widget-action]").val(n)},load_form:function(e,t){jQuery.ajax({url:KPB_Config.ajax,dataType:"html",type:"POST",async:!0,data:{action:"kpb_load_widget_form",security:jQuery("#kpb_load_widget_form_security").val(),widget_id:t,class_name:e,post_id:jQuery("#post_ID").val()},success:function(e){jQuery("#kpb-widget .kpb-form-inner").html(e)},beforeSend:function(){KPB_Overlay.show()},complete:function(){KPB_Assets.init(),KPB_Overlay.hide()}})},add:function(e,t,a,i){var n;e.preventDefault(),jQuery.magnificPopup.close(),n=KPB_Widget._get_id(),jQuery.magnificPopup.open({callbacks:{open:function(){var e;jQuery(n).show(),e=KPB_Util.get_random_id("widget-"),KPB_Widget.prepare_form(e,i,i,a,"add"),KPB_Widget.load_form(a,e)},close:function(){KPB_Widget.close(e)}},modal:!0,preloader:!0,alignTop:!0,items:{src:n,type:"inline"}})},edit:function(e,t,a){var i,n,o,r;e.preventDefault(),kpb_current_widget=t.parents(".kpb-widget"),n=KPB_Widget._get_id(),i=kpb_current_widget.attr("data-class"),o=kpb_current_widget.attr("data-name"),r=kpb_current_widget.find("label").text(),jQuery.magnificPopup.open({callbacks:{open:function(){jQuery(n).show(),KPB_Widget.prepare_form(a,o,r,i,"edit"),KPB_Widget.load_form(i,a)},close:function(){KPB_Widget.close(e)}},modal:!0,preloader:!0,alignTop:!0,items:{src:n,type:"inline"},fixedBgPos:!0})},"delete":function(e,t,a){var i,n,o,r,u;e.preventDefault(),n=confirm(KPB_Config.i18n.are_you_sure_to_remove_this_widget),n&&(i=t.closest(".kpb-widget"),o=i.attr("data-class"),r=jQuery("#kpb-select-layout option:selected").val(),u=jQuery("#post_ID").val(),jQuery.ajax({url:KPB_Config.ajax,dataType:"html",type:"POST",async:!0,data:{action:"kpb_delete_widget",security:jQuery("#kpb_delete_widget_security").val(),widget_id:a,post_id:u,class_name:o,layout_slug:r},success:function(){i.remove(),KPB.force_save()},beforeSend:function(){KPB_Overlay.show()},complete:function(){KPB_Overlay.hide()}}))},save:function(e,t){e.preventDefault(),t.ajaxSubmit({dataType:"json",type:"POST",async:!0,beforeSubmit:function(){KPB_Overlay.show()},success:function(e){jQuery("#kpb-widget input[name=kpb-widget-action]").val("edit"),"edit"===e.action?(kpb_current_widget.length||(kpb_current_widget=jQuery("#"+e.id)),kpb_current_widget.length&&kpb_current_widget.find("label").text(e.label.kpb_escape())):"add"===e.action&&e.visual&&kpb_current_sidebar.find(KPB_Widget._get_placeholder_class()).append(e.visual),jQuery("#kpb-tab-widget-kpb").html(e.form.kpb_escape()),KPB.force_save()},complete:function(){KPB_Assets.init(),KPB_Overlay.hide()}})},close:function(e){e.preventDefault(),jQuery.magnificPopup.close(),jQuery("#kpb-widget .kpb-form-inner").html('<center class="kpb-loading">'+KPB_Config.i18n.loading+"</center>"),KPB_Overlay.hide(),jQuery("#kpb-widget-title").text(""),jQuery("#kpb-widget input[name=kpb-widget-class-name]").val(""),jQuery("#kpb-widget input[name=kpb-widget-action]").val("add"),jQuery("#kpb-widget input[name=kpb-widget-id]").val(""),jQuery("#kpb-widget input[name=kpb-widget-name]").val("")}},KPB_Row={_get_id:function(e,t){return"#kpb-customize-lightbox-"+e+"-"+t},load:function(e,t,a){jQuery.ajax({url:KPB_Config.ajax,dataType:"html",type:"POST",async:!0,data:{action:"kpb_load_row_customize",security:jQuery("#kpb_load_row_customize_security").val(),post_id:jQuery("#post_ID").val(),layout_slug:t,row_slug:a},beforeSend:function(){KPB_Overlay.show()},success:function(e){e&&jQuery("body").append(e)},complete:function(){KPB_Overlay.hide(),KPB_Assets.init(),KPB_Row.show(e,t,a)}})},show:function(e,t,a){var i;i=KPB_Row._get_id(t,a),jQuery.magnificPopup.open({callbacks:{open:function(){jQuery(i).show()},close:function(){jQuery(i).hide()}},modal:!0,preloader:!0,alignTop:!0,items:{src:i,type:"inline"}})},open:function(e,t,a,i){var n;e.preventDefault(),n=KPB_Row._get_id(a,i),jQuery(n).length?KPB_Row.show(t,a,i):KPB_Row.load(t,a,i)},save:function(e,t,a){e.preventDefault(),t.ajaxSubmit({beforeSubmit:function(){KPB_Overlay.show()},success:function(){KPB_Overlay.hide()},data:{post_id:a}})},close:function(e){e.preventDefault(),KPB_Widget.close(e)}},KPB_Col={_get_id:function(e,t,a){return"#kpb-customize-lightbox-"+e+"-"+t+"-"+a},edit:function(e,t){var a,i,n,o;e.preventDefault(),a=t.closest(".kpb-area").attr("data-area"),o=t.closest(".kpb-section").attr("data-section"),i=t.closest(".kpb-layout ").attr("data-layout"),n=KPB_Col._get_id(i,o,a),jQuery(n).length?KPB_Col.show(i,o,a):KPB_Col.load(i,o,a)},load:function(e,t,a){jQuery.ajax({url:KPB_Config.ajax,dataType:"html",type:"POST",async:!0,data:{action:"kpb_load_col_customize",security:jQuery("#kpb_load_col_customize_security").val(),post_id:jQuery("#post_ID").val(),layout_slug:e,row_slug:t,col_slug:a},beforeSend:function(){KPB_Overlay.show()},success:function(e){e&&jQuery("body").append(e)},complete:function(){KPB_Overlay.hide(),KPB_Assets.init(),KPB_Col.show(e,t,a)}})},show:function(e,t,a){var i;i=KPB_Col._get_id(e,t,a),jQuery.magnificPopup.open({callbacks:{open:function(){jQuery(i).show()},close:function(){jQuery(i).hide()}},modal:!0,preloader:!0,alignTop:!0,items:{src:i,type:"inline"}})},save_customize:function(e,t){e.preventDefault(),t.ajaxSubmit({beforeSubmit:function(){KPB_Overlay.show()},success:function(){KPB_Overlay.hide()},data:{post_id:jQuery("#post_ID").val()}})},close_customize:function(e){e.preventDefault(),KPB_Lightbox.close()}},KPB_Layouts={change:function(e,t){var a;e.preventDefault(),a=t.find("option:selected").val(),jQuery(KPB_Layout._get_id(a)).length?KPB_Layout.change(a):KPB_Layout.load(a)}},KPB_Layout={_get_id:function(e){return"#kpb-layout-"+e},get_btn_customize_id:function(){return"#kpb-button-customize-layout"},get_btn_preview_id:function(){return"#kpb-button-hide-preview"},load:function(e){jQuery.ajax({url:KPB_Config.ajax,dataType:"html",type:"POST",async:!0,data:{action:"kpb_load_layout",security:jQuery("#kpb_load_layout_security").val(),post_id:jQuery("#post_ID").val(),layout_slug:e},beforeSend:function(){KPB_Overlay.show()},success:function(e){e&&(jQuery(KPB_Wrapper._get_id()).append(e),KPB_Widget.get_placeholder())},complete:function(){KPB_Overlay.hide(),KPB_Assets.init(),KPB_Layout.change(e)}})},change:function(e){var t,a;a=KPB_Layout._get_id(e),jQuery(a).hasClass("kpb-active")||(jQuery(".kpb-layout.kpb-active").removeClass("kpb-active").addClass("kpb-hidden"),jQuery(a).removeClass("kpb-hidden").addClass("kpb-active"),KPB_Layout.toggle_customize(a),KPB_Layout.toggle_preview(a)),t="disable"!==e,KPB_Main_Form.mark_it(t)},toggle_customize:function(e){var t;t=parseInt(jQuery(e).attr("data-has-customize")),t?jQuery(KPB_Layout.get_btn_customize_id()).show():jQuery(KPB_Layout.get_btn_customize_id()).hide()},toggle_preview:function(e){var t;t=parseInt(jQuery(e).attr("data-has-preview")),t?jQuery(KPB_Layout.get_btn_preview_id()).show():jQuery(KPB_Layout.get_btn_preview_id()).hide()},save_layout:function(e,t){var a;e.preventDefault(),a=KPB_Layout.grab_layout_data(t),jQuery.ajax({url:KPB_Config.ajax,dataType:"html",type:"POST",async:!0,data:{action:"kpb_save_layout",security:jQuery("#kpb_save_layout_security").val(),data:a,post_id:jQuery("#post_ID").val()},error:function(){},beforeSend:function(){KPB_Overlay.show(),t.text(KPB_Config.i18n.saving)},success:function(){t.text(KPB_Config.i18n.save)},complete:function(){KPB_Overlay.hide()}})},grab_layout_data:function(){var e,t,a,i;return a=jQuery("#kpb-select-layout option:selected").val(),e=jQuery(KPB_Layout._get_id(a)),t={layout_slug:a,rows:[]},i=e.find(".kpb-section"),i.length>0&&i.each(function(e,a){var i,n,o;n=jQuery(a),o={name:n.attr("data-section"),cols:[]},i=n.find(".kpb-area"),i.length>0&&(i.each(function(e,t){var a,i,n;i=jQuery(t),a={name:i.attr("data-area"),widgets:[]},n=i.find(".kpb-widget"),n.length>0&&(n.each(function(e,t){var i,n;i=jQuery(t),n={id:i.attr("id"),name:i.attr("data-name"),class_name:i.attr("data-class")},a.widgets.push(n)}),o.cols.push(a))}),o.cols.length&&t.rows.push(o))}),t}},KPB_Layout_Customize={_get_id:function(e){return"#kpb-layout-customize-lightbox-"+e},load:function(e){jQuery.ajax({url:KPB_Config.ajax,dataType:"html",type:"POST",async:!0,data:{action:"kpb_load_layout_customize",security:jQuery("#kpb_load_layout_customize_security").val(),layout_slug:e,post_id:jQuery("#post_ID").val()},beforeSend:function(){KPB_Overlay.show()},success:function(e){e&&jQuery("body").append(e)},complete:function(){KPB_Assets.init(),KPB_Layout_Customize.show(e),KPB_Overlay.hide()}})},show:function(e){var t;t=KPB_Layout_Customize._get_id(e),jQuery(t).length&&jQuery.magnificPopup.open({callbacks:{open:function(){jQuery(t).show()},close:function(){jQuery(t).hide()}},modal:!0,preloader:!0,alignTop:!0,items:{src:t,type:"inline"}})},open:function(e){var t,a;e.preventDefault(),t=jQuery("#kpb-select-layout option:selected").val(),a=KPB_Layout_Customize._get_id(t),jQuery(a).length?KPB_Layout_Customize.show(t):KPB_Layout_Customize.load(t)},save:function(e,t,a){e.preventDefault(),t.ajaxSubmit({beforeSubmit:function(){KPB_Overlay.show()},success:function(){KPB_Overlay.hide()},data:{post_id:a}})},close:function(e){e.preventDefault(),KPB_Widget.close(e)}},KPB_Util={get_random_id:function(e){return e+Date.now().toString(36).substr(2,5)}},KPB_UI={init:function(){KPB_UI_Image.init(),KPB_UI_Color.init(),KPB_UI_Numeric_Slider.init()}},KPB_UI_Image={init:function(){jQuery(".kpb-ui-image-outer").on("click",".kpb-ui-image-button-upload",function(e){return e.preventDefault(),kpb_media_button_upload=jQuery(this),kpb_media?(kpb_media.open(),void 0):(kpb_media=wp.media.frames.kpb_media=wp.media({title:KPB_Config.i18n.media_center,button:{text:KPB_Config.i18n.choose_image},library:{type:"image"},multiple:!1}),kpb_media.on("select",function(){var e;e=kpb_media.state().get("selection").first().toJSON(),kpb_media_button_upload.parents(".kpb-ui-image-outer").find(".kpb-ui-image").val(e.url),kpb_media_button_upload.parents(".kpb-ui-image-outer").find(".kpb-ui-image-preview").attr("src",e.url)}),kpb_media.open(),void 0)}),jQuery(".kpb-ui-image-outer").on("click",".kpb-ui-image-button-reset",function(e){e.preventDefault(),kpb_media_button_reset=jQuery(this),kpb_media_button_reset.attr("data-reset")?(kpb_media_button_reset.parents(".kpb-ui-image-outer").find(".kpb-ui-image").val(kpb_media_button_reset.attr("data-reset")),kpb_media_button_reset.parents(".kpb-ui-image-outer").find(".kpb-ui-image-preview").attr("src",kpb_media_button_reset.attr("data-reset"))):(kpb_media_button_reset.parents(".kpb-ui-image-outer").find(".kpb-ui-image").val(kpb_media_button_reset.attr("")),kpb_media_button_reset.parents(".kpb-ui-image-outer").find(".kpb-ui-image-preview").attr("src",kpb_media_button_reset.attr("data-preview")))})}},KPB_UI_Color={init:function(){jQuery(".kpb-ui-color").wpColorPicker()}},KPB_UI_Numeric_Slider={_get_class:function(){return".kpb-ui-numeric-slider"},init:function(){var e;e=jQuery(KPB_UI_Numeric_Slider._get_class()),e.length&&jQuery.each(e,function(){var e,t,a,i,n,o,r,u,_,s,l,p,d;t=jQuery(this),a=t.closest(".kpb-ui-numeric-slider--outer"),n=a.find(".kpb-ui-numeric-slider--control"),e=a.find(".kpb-ui-numeric-slider--filler"),i=a.find(".kpb-ui-numeric-slider--preview"),l=t.attr("data-start"),_=t.attr("data-prefix"),o=t.attr("data-affix"),s=t.attr("data-preview"),u=parseFloat(t.attr("data-min")),r=parseFloat(t.attr("data-max")),p=parseFloat(t.attr("data-step")),d=t.val(),n.slider({value:d,min:u,max:r,step:p,slide:function(a,n){var u;d=parseFloat(n.value),u=d/r*100,t.val(n.value),d>0?("percent"===s?i.text(u.toString().substring(0,5)+"%"):i.text(_+n.value+o),e.css("width",u+"%")):(i.text(_+l+o),e.css("width","0%"))}})})}},KPB_UI_Attachment_Image={edit:function(e,t){var a,i,n,o;e.preventDefault(),i=t.parent(),n=i.find(".kpb-ui-attachment-image--input"),o=i.find(".kpb-ui-attachment-image--thumb").first(),a=i.find(".kpb-ui-attachment-image--remove").first(),$kpb_media_2nd?$kpb_media_2nd.open():($kpb_media_2nd=wp.media.frames.$kpb_media_2nd=wp.media({title:KPB_Config.i18n.media_center,button:{text:KPB_Config.i18n.choose_image},library:{type:"image"},multiple:!1}),$kpb_media_2nd.on("open",function(){var e,t,a;a=parseInt(n.val(),10),a&&(t=$kpb_media_2nd.state().get("selection"),e=wp.media.attachment(a),e.fetch(),t.add(e))}),$kpb_media_2nd.on("select",function(){var e;e=$kpb_media_2nd.state().get("selection").first().toJSON(),n.val(e.id),o.attr("src",e.sizes.thumbnail.url),o.removeClass("kpb--is_hidden"),t.hide(),a.show(),$kpb_media_2nd=!1}),$kpb_media_2nd.open())},remove:function(e,t){var a,i,n,o;e.preventDefault(),i=t.parent(),n=i.find(".kpb-ui-attachment-image--input"),o=i.find(".kpb-ui-attachment-image--thumb").first(),a=i.find(".kpb-ui-attachment-image--edit").first(),n.val(0),o.attr("src",""),o.addClass("kpb--is_hidden"),a.show(),t.hide()}},KPB_Lightbox={close:function(){jQuery.magnificPopup.close()}},KPB_Tips={hide_screenshot:function(e,t){e.preventDefault(),"0"===t.attr("data-status")?(jQuery(".kpb-layout > .kpb-row > .kpb-col-left").removeClass("kpb-col-12").addClass("kpb-col-8"),jQuery(".kpb-layout > .kpb-row > .kpb-col-right").show(),t.attr("data-status","1"),t.text(KPB_Config.i18n.hide_preview)):(jQuery(".kpb-layout > .kpb-row > .kpb-col-left").removeClass("kpb-col-8").addClass("kpb-col-12"),jQuery(".kpb-layout > .kpb-row > .kpb-col-right").hide(),t.attr("data-status","0"),t.text(KPB_Config.i18n.show_preview))}},String.prototype.kpb_escape=function(){return this.replace(/\\n/g,"\\n").replace(/\\'/g,"\\'").replace(/\\"/g,'"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f")};